<!DOCTYPE html>
<html lang="en" style="margin:0; padding:0; height:100%;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>every idea ever /hr</title>
  <style>
    html, body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    body {
      background: #d6c7aa;
      font-family: "Courier New", Consolas, monospace;
      white-space: pre;
      display: flex;
      flex-direction: column;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto 1fr;
      grid-template-areas:
        "header header"
        "left right";
      height: 100%;
      gap: 0;
      flex: 1;
    }

    /* ASCII art wrapper with scaling */
    .ascii-wrapper {
      overflow: auto;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ascii-content {
      transform-origin: center;
      white-space: pre;
      line-height: 1;
      font-size: 0.7rem; /* Base size for ASCII art */
    }

    .header {
      grid-area: header;
      border: 1px solid black;
      line-height: 1;
      padding: 1rem;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      overflow: auto;
      max-height: 25vh; /* Limit header height */
    }

    .header-ascii {
      flex: 1;
      min-width: 320px;
      white-space: pre;
      line-height: 1;
    }

    .header-text {
      flex: 1;
      min-width: 300px;
      white-space: pre-wrap;
      line-height: 1.2;
      padding-left: 10px;
    }

    .left {
      grid-area: left;
      overflow: auto;
      border: 1px solid black;
      line-height: normal;
      white-space: pre;
    }

    .right {
      grid-area: right;
      display: grid;
      grid-template-rows: 1fr 1fr;
      height: 100%;
    }

    .top-right {
      overflow: auto;
      border: 1px solid black;
      white-space: pre-wrap;
      font-family: "Courier New", Consolas, "Lucida Console", monospace;
      font-size: 0.8rem;
    }

    .bottom-right {
      overflow: hidden;
      border: 1px solid black;
      position: relative;
      padding: 0;
    }

    .box {
      padding: 1rem;
    }
    
    .bottom-right.box {
      padding: 0;
    }

    /* Display elements styling */
    #idea-container {
      margin-top: 1rem;
    }
    
    #idx, #tweet, #reply, #countdown {
      white-space: pre-wrap;
      word-break: break-word;
      display: block;
      margin-bottom: 0.5rem;
    }

    /* Hide scrollbars but keep functionality */
    ::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
    }
    
    /* ASCII idea line styling */
    #ascii-idea-line {
      white-space: pre;
      overflow: hidden;
    }

    /* ASCII Barcode styling */
    .ascii-barcode-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      font-family: monospace;
      line-height: 1;
      white-space: pre;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
    }
    
    .ascii-barcode {
      display: block;
      width: 100%;
      text-align: center;
      padding-top: 0;
      font-size: 0.7rem;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .ascii-content {
        font-size: 0.6rem;
      }
    }

    @media (max-width: 900px) {
      .ascii-content {
        font-size: 0.5rem;
      }
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto 1fr;
        grid-template-areas:
          "header"
          "left"
          "right";
      }
      
      .left {
        max-height: 30vh;
      }
      
      .header-ascii, .header-text {
        width: 100%;
        font-size: 0.7rem;
      }
      
      .ascii-content {
        font-size: 0.45rem;
      }
    }

    @media (max-width: 480px) {
      .ascii-content {
        font-size: 0.4rem;
      }
      
      .header {
        font-size: 0.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="grid">
    <div class="header">
      <div class="header-ascii ascii-wrapper">
        <div class="ascii-content">
                                                __                     
                                         __    /\ \                    
   __   __  __     __   _ __   __  __   /\_\   \_\ \     __     __         __   __  __     __   _ __      
 /'__`\/\ \/\ \  /'__`\/\`'__\/\ \/\ \  \/\ \  /'_` \  /'__`\ /'__`\     /'__`\/\ \/\ \  /'__`\/\`'__\     
/\  __/\ \ \_/ |/\  __/\ \ \/ \ \ \_\ \  \ \ \/\ \L\ \/\  __//\ \L\.\_  /\  __/\ \ \_/ |/\  __/\ \ \/    
\ \____\\ \___/ \ \____\\ \_\  \/`____ \  \ \_\ \___,_\ \____\ \__/.\_\ \ \____\\ \___/ \ \____\\ \_\ 
 \/____/ \/__/   \/____/ \/_/   `/___/> \  \/_/\/__,_ /\/____/\/__/\/_/  \/____/ \/__/   \/____/ \/_/   
                                   /\___/                              
                                   \/__/                                                               
        </div>
      </div>
      <div class="header-text">
choose what u seek, or it is chosen for u. but prefer to choose what is chosen for u .

        +u r a operator +u r a seer +u r a archivist + u r a witness +u r a oracle
        +u r a operator +u r a seer +u r a archivist + u r a witness +u r a oracle
        +u r a operator +u r a seer +u r a archivist + u r a witness +u r a oracle
      </div>
    </div>

    <div class="left box ascii-wrapper">
      <div class="ascii-content">                                                                                                                                                                          
                                ▏▌▊▉▂▂▂▉▊▋▏                                             
                             ▎▉▃▄▉▍▌▋▄▂▄███▅▉▎                                           
                          ▌▅▄▉▏  ▏▋▌▍▊▉▁▆██▇▋                                         
                        ▏▊▄▂▋▍▎▏▋▃▆██▄▄▄▆█▇▇█▁▎                                        
                      ▍▅▄▋▏▏▍▆▇▆▇███▇▇▇█▇▊▂██                                     
                      ▌▇▁▍ ▎▁▉▁▂▁▊▁▉▂▂▃▃█▇▆███▁▏                                      
                        ▏▊▄▁▎ ▊▆█████▇███████████▃▏                                      
                      ▏▍▄▊▎▏▉▉▁▅▄▉▃▊█▆██▇█████▏                                      
                       ▎▇▃▌▌▌▆▇▇▁ ▏▎█▋▄████▆██▇▋     .-.     .-.     .-.     .-.     .-.     .-.     .-.     .-.     .-.     .-.                                    
                      ▏▎▊█▃▊▋▊▆██▋ ▏ ▋▅█████████▁▍my   \ idea  \  is   \  ...  \       \       \       \       \<span id="ascii-idea"></span>                                     
                       ▍▁▄██▃▂▁██▂ ▏▃▄▆▅██████████▃▍'     `-'     `-'     `-'     `-'     `-'     `-'     `-'     `-'     `-'     `                                  
                   ▏▏▏▎▍▎▉▆█▅███▂▊▏▎▋▉▃███████████▄                                  
                  ▎ ▎▍▍▏▌▏▋▅████▅▇▆▆▆▇██████████████▇                                
                  ▏▎▎▎▏▏▎▏▋▏▎▂████▇████████████████████▅                               
                 ▏▏▏▏ ▏▍▍▏▏▉▍▏▊▇█████████████████▃▄▇▅▇██▅▏                              
                ▍▋▍▏    ▏▍▍▏▍▎▎▋▅███████████████▅▁▂▉▄▆▆██▁                              
                ▊▏▍▋▊▉▋▎  ▏▍▎▌▋▌▏▉▇██████████▆▁▍ ▏▁▅▇▄▉███▎                             
               ▏▏▎▎▎▎▎▋▂▅▁▉▌▏▏▍▊▂▃▂▁▃▄▃███▅▉▍ ▎▉▄██▂▊▃▁▇█                             
              ▏▊▍▍▌▏▏▍▊▍▋▄▊▋▉▊▂▊▍▏▏▍▌▋▂▃▉▍ ▏▊▄▇▆▆▇▆▂▋▉                          
              ▌▌▎ ▏▊▄▂▊▍▏▎▋▋▎▎▋▅▁▂▊▉▍▎▏ ▏▊▂▄▂▁▃▊▊▎ ▎▁▃▄▄▃                          
            ▏▍▊▏▎▍▌▍▉████▅▂▊▎ ▏▌▊▉▋▎ ▏▋▊▉▍▍▍▌▎ ▎▋▂▆██▇▍▋▌                      
            ▏▋▏▍▍▍▍▋▇█████▇▋▉▃▉▎▏ ▎▊▉▁▋▍▎▏▏▍▊▂▆███████▂ ▎▋                       
          ▏▉▌▍▍▍▍▍████████▆▄▂▌▍▁▆█▅▃▋▉▊▉▃▇█▆▆████████▅▁▌▏▁▇█▅▎                        
          ▍▃▎▍▌▋▁▇█████▇▆▄▅▄▃▁▂▋▋▌▎▎▏▋ ▏▋ ▊▋▊▁▇███████▃▊▌▌▉▅█                        
        ▎▄▋▋▋▉▊▂▉▌▋▌▎▎ ▍ ▍▏▎▌▏ ▌▎ ▋▌▋▌▊▌▌▊▎▉▂▄███▆▅▅▄▄▂▉▋▋                   
      ▏▉▄▍▋▋▏▊▏▍ ▌ ▎▏▏▍ ▊▋▊▂▂▃▆█▆███████▃▆▇▆████▊▍ ▍▎▍▏▎▍                    
      ▏▃▋▂▎▎▋▁▊▂▋▁▉▃▁▂▆▇▇██████▇▇▅▅▄▆████████████▄▂▉▃▂▄▄▆▇█                     
        ▉███▄▅███▅▂▁▂▆███████▆▋▍▍▎▋▏▌▊▎▄▅█████████▄▁▁▃▇██████▄▏                     
        ▏▉█████▄▎   ▎▌▃████▇▃▃▆▂▌▃▅▅▇█▇█████████▂▏   ▏▌█████▃▏                       
          ▏▋▎▁▍▂▊▏ ▏▋▎ ▎▅█████▅█████████████████▋▎▍▏  ▎▊██▁▉                        
            ▏ ▍▎█▄▋▌▌▏▍▌▌▍██████████████████████▆▋▏ ▎▍▌▁▇██▆▏ ▏                        
                 ▉███▆▊▌▏▏▋▅██████████████████████▂▏▋▍▏▋▆█████▌                          
                 ▍███▅▋▍▁▂▁▊▅████████████████████▇▊▊▏▋▄▅██████                          
                 ▎▆█████▁▌▌▊▄▇███████████████████▃▍▎▉▁▇██████▆                          
                 ▏▃█████▆▆▉▁▅▇███████████████████▊▍▌▍▃▅▇████                          
                   ▊████▇▆▂▌▄█▇███████████████████▂▌▎▁▅▆█████▅                          
                   ▋█▇█████▇▆▅▄███████████████████▇▄▆███████▇▁▍                         
                   ▏▅▌███████▆██████████████████████████████▋▁▍█                          
                   ▍▁▎▋████████████████████████████████████▉ ▋▌█                          
                   ▏▌▍ ▊██████████████████████████████████▂  ▏▊█▎                         
                    ▏▋  ▋█████████▄▃▇██████████▇▇████████▁▏   ▋▁▌                         
                    ▎▌   ▋▇██████▌▂▅▅███████▄▅▅█████████▊▎    ▍▉▁                         
                   ▎▌▌   ▏▍▄████▇▆███████████▆█████████▊▏   ▏▌▅▅▅▊▋▌▍▎▎▏                  
    ▏▎▎▎▎▎▎▎▌▍▌▍     ▌▉▁▃▄▄▄▇███▅▄▃▃▅████▄▄▃▂▁▋▏ ▎▌▊▉▁▁▉▋▌▍▍▍▍▍▍▎▏                 
                                      ▏▎▏▏      ▏▎▏    
      </div>
    </div>

    <div class="right">
      <div class="top-right box">
        <div id="idea-container">
          <span>> Current index:</span>
          <span id="idx">‑</span>
          <span>> Idea String:</span>
          <span id="tweet">‑</span>
          <span>> Idea:</span>
          <span id="reply">‑</span>
          <span id="countdown">‑</span>
        </div>
      </div>
      <div class="bottom-right box">                                                                                                                                                                                                                                                                          
        <!-- ASCII barcode will fill this entire section -->
        <div class="ascii-barcode-container">
          <div id="ascii-barcode" class="ascii-barcode"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Simple function to create an ASCII art barcode representation that fills the container
    function generateASCIIBarcode(text) {
      if (!text) return ""; 
      
      // Get container dimensions
      const container = document.querySelector('.bottom-right');
      const availableHeight = container.clientHeight; // Using full height now
      
      // Calculate how many lines we can fit in the available height
      let barcodeHeight = Math.floor(availableHeight / 16); // Approximate line height
      barcodeHeight = Math.max(8, barcodeHeight); // Ensure at least 8 lines
      
      let result = "";
      
      // Create a simple pattern based on the character codes
      let pattern = "";
      for (let i = 0; i < text.length; i++) {
        let charCode = text.charCodeAt(i);
        // Convert the character code to a binary-like pattern
        let binPattern = (charCode % 2 === 0) ? "█ " : " █";
        let binPattern2 = (charCode % 3 === 0) ? "██ " : " ██";
        let binPattern3 = (charCode % 5 === 0) ? "█  " : "  █";
        
        // Add some variation based on the character
        pattern += binPattern + binPattern2 + binPattern3;
      }
      
      // Add start and end markers for the barcode
      pattern = "█ █" + pattern + "█ █";
      
      // Generate the multi-line barcode
      for (let i = 0; i < barcodeHeight; i++) {
        result += pattern + "\n";
      }
      
      return result;
    }

    // Function to dynamically adjust the ASCII art scaling
    function adjustAsciiArtScaling() {
      const wrappers = document.querySelectorAll('.ascii-wrapper');
      
      wrappers.forEach(wrapper => {
        const content = wrapper.querySelector('.ascii-content');
        if (!content) return;
        
        // Calculate the appropriate scale based on container size and content size
        let containerWidth = wrapper.clientWidth;
        let contentWidth = content.scrollWidth;
        
        // Only scale down, never up
        if (contentWidth > containerWidth) {
          const scale = Math.max(0.3, containerWidth / contentWidth);
          content.style.transform = `scale(${scale})`;
        } else {
          content.style.transform = 'scale(1)';
        }
      });
    }

    async function refresh() {
      const res = await fetch("/api/current");
      const data = await res.json();

      // Update the data in the top-right panel
      document.getElementById("idx").textContent = data.index;
      document.getElementById("tweet").textContent = data.prompt;
      document.getElementById("reply").textContent = data.reply;
      
      // Also update the ASCII art line to include the idea string
      document.getElementById("ascii-idea").textContent = data.prompt;
      
      // Generate and update the ASCII barcode
      document.getElementById("ascii-barcode").textContent = generateASCIIBarcode(data.prompt);

      let secs = data.seconds_until_next;

      function tick() {
        const m = String(Math.floor(secs / 60)).padStart(2, "0");
        const s = String(secs % 60).padStart(2, "0");

        document.getElementById("countdown").textContent =
            `Next idea in ${m}:${s}`;

        if (secs-- > 0) setTimeout(tick, 1000);
        else refresh();
      }
      tick();
    }
    
    // Start the process on page load
    refresh();
    
    // Run scaling function on load and whenever window is resized
    window.addEventListener('load', adjustAsciiArtScaling);
    window.addEventListener('resize', () => {
      adjustAsciiArtScaling();
      
      const currentText = document.getElementById("tweet").textContent;
      if (currentText !== "‑") {
        document.getElementById("ascii-barcode").textContent = generateASCIIBarcode(currentText);
      }
    });
  </script>
</body>
</html>
